---
title: scheme_generation_zh-CN
date: 2025-10-19 10:51:05
author: DDLG
categories: DynamicColor
tags: DynamicColor
---

# MCU 方案生成

## 动态方案的要求

如[动态配色方案](dynamic_color_scheme_zh-CN.md)中所述，`DynamicScheme` 生成旨在生成满足视觉无障碍性、视觉表达和颜色真实性约束的颜色。

### 硬性约束

1.  前景和背景之间的对比度应在指定范围内。
2.  某些颜色角色应在指定的色调范围内。
3.  x 和 xContainer 对（例如 primary 和 primaryContainer）之间的色调增量应高于最小值。
4.  secondaryContainer 优先匹配色度而不是色调。这意味着它可能会在特定方向上调整色调，以使色度尽可能接近所需的色度。
5.  tertiaryContainer 不应令人反感，否则会将其调亮。

### 软性约束

1.  色调应尽可能接近“参考标准”。
2.  色调的分布在各种颜色中应均匀。
3.  对比度级别理想情况下应处于某个水平，但不是必需的。

## MCU 如何派生动态方案

上述约束表示为代数公式，并按以下步骤求解：

### 1. 起始色调规范

MCU 根据设计规范为所有颜色分配一个“起始”色调值。所有颜色都分配一个用于亮色主题的起始色调和一个用于暗色主题的起始色调。例如，primary 在亮色主题中使用色调 40（更白），在暗色主题中使用色调 80。

![显示颜色角色所用色调的色调规范](/images/tone_spec.png)

在非保真方案中，每个动态颜色的色调级别保持固定。在保真方案中，MCU 可以调整色调以达到首选色度，如步骤 3 中所述。

### 2. 色相和色度规范

MCU 根据方案变体规范为所有颜色分配其色相和色度值。

![色相和色度规范](/images/hue_chroma_spec.png)

例如，此处的方案变体将主调色板设置为使用与源颜色相同的色相 (H270)，而三次调色板将色相偏移 30 (H300)。

### 3. 保真度色调调整

在上述步骤 (1) 和 (2) 之后，方案中的每种颜色都具有创建颜色所需的 HCT 值。但是，生成的颜色可能需要修改，因为它在视觉上不是最佳的或“不可能的”，即给定色相的颜色在指定的色调下无法达到指定的色度。

![保真度调整规范](/images/fidelity_spec.png)

为了修改此类颜色，MCU 可以使用两种可能的“保真度”行为之一来调整其色调。

- 源：调整颜色的色调以匹配源颜色的色调。
- 达到色度：调整颜色的色调，直到颜色的色度达到变体指定的色度。

### 4. 全局色调约束

在调整颜色色调时，MCU 遵循全局约束以确保视觉层次和质量。当保真度色调调整和全局色调约束冲突时，全局色调约束优先。

### 5. 对比度色调调整和要求

最后，MCU 通过评估颜色与其分配的背景之间的对比度来调整色调以满足对比度要求。在未达到目标对比度的颜色/背景配对中，MCU 会根据设置的对比度级别调整前景颜色的色调以达到目标比率。

请注意，对比度可能并不总是能达到目标。例如，如果背景颜色是中间色调 T50，其最高对比度的“on-color”（白色）只能达到约 4.5:1 的对比度。但是，这些目标将确保满足 GAR/WCAAG 的最低要求。

## 引用

- [Dynamic Color](https://github.com/material-foundation/material-color-utilities)
